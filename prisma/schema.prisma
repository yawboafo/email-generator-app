generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model City {
  id         String   @id
  name       String
  countryId  String
  population Int?
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  Country    Country  @relation(fields: [countryId], references: [id], onDelete: Cascade)

  @@unique([name, countryId])
  @@index([countryId])
}

model Country {
  id        String      @id
  code      String      @unique
  name      String
  createdAt DateTime    @default(now())
  updatedAt DateTime
  City      City[]
  FirstName FirstName[]
  LastName  LastName[]

  @@index([code])
}

model EmailGeneration {
  id           String   @id
  emailAddress String
  countryCode  String
  pattern      String
  provider     String
  createdAt    DateTime @default(now())

  @@index([countryCode])
  @@index([createdAt])
}

model EmailProvider {
  id         String   @id
  providerId String   @unique
  name       String
  domain     String
  popularity Int      @default(50)
  active     Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime

  @@index([active])
}

model FirstName {
  id        String   @id
  name      String
  gender    String
  countryId String
  frequency Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime
  Country   Country  @relation(fields: [countryId], references: [id], onDelete: Cascade)

  @@unique([name, countryId, gender])
  @@index([countryId, gender])
  @@index([countryId])
}

model LastName {
  id        String   @id
  name      String
  countryId String
  frequency Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime
  Country   Country  @relation(fields: [countryId], references: [id], onDelete: Cascade)

  @@unique([name, countryId])
  @@index([countryId])
}

model Pattern {
  id          String   @id
  name        String   @unique
  template    String
  description String
  category    String
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([active])
  @@index([category])
}

model PatternElement {
  id        String   @id
  type      String
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@unique([type, value])
  @@index([type])
}

model SavedEmail {
  id           String   @id
  emailAddress String
  name         String?
  countryCode  String?
  provider     String?
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime

  @@index([createdAt])
}

model VerifiedEmail {
  id                String   @id
  emailAddress      String   @unique
  status            String
  verificationData  Json?
  lastVerifiedAt    DateTime @default(now())
  verificationCount Int      @default(1)
  createdAt         DateTime @default(now())
  updatedAt         DateTime

  @@index([emailAddress])
  @@index([lastVerifiedAt])
  @@index([status])
}

model Job {
  id         String   @id @default(cuid())
  type       String   // generate-emails, verify-emails, scrape-emails, ai-generate, etc.
  status     String   // pending, running, completed, failed, cancelled
  progress   Int      @default(0) // 0-100
  resultData Json?    // Final results when completed
  metadata   Json?    // Job parameters and intermediate state
  errorMessage String? // Error details if failed
  userId     String?  // Optional user tracking
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  completedAt DateTime?
  
  @@index([type])
  @@index([status])
  @@index([userId])
  @@index([createdAt])
  @@index([status, type])
}
